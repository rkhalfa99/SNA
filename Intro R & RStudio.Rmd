---
title: "Introductie R & Rstudio"
author: "Robin Khalfa"
date: "`r Sys.Date()`"
output:
  pdf_document: default
  html_document:
    df_print: paged
---

## Inleiding

R is een krachtige en veelzijdige programmeertaal die specifiek ontwikkeld werd voor statistische data analyse en datavisualisatie. Door zijn *open source* en uitgebreid ecosysteem aan packages wordt R wereldwijd gebruikt in academisch onderzoek, overheidsinstellingen, private bedrijven en in de industrie. R biedt ondersteuning voor zowel eenvoudige beschrijvende statistiek als voor het ontwikkelen en toepassen van complexe statistische modellen en algoritmes, waardoor het bijzonder geschikt is voor verschillende datawetenschappelijke toepassingen.

RStudio daarentegen is een geïntegreerde ontwikkelomgeving (IDE) die ontworpen is om 'werken met R' te vergemakkelijken. Het biedt een gebruiksvriendelijke interface, ingebouwde hulpmiddelen voor scriptbeheer, versiecontrole, visualisatie en interactieve rapportage.

Dit document biedt een introductie tot de basisfunctionaliteiten van R en RStudio. Aan de hand van concrete voorbeelden wordt getoond hoe men data kan inladen, manipuleren, visualiseren en analyseren. De nadruk ligt op het verwerven van praktische vaardigheden die de gebruiker in staat moet stellen om zelfstandig analyses uit te voeren en resultaten op een transparante manier te rapporteren.

De structuur van dit document is als volgt:

1.  **Gebruik van packages**\
    In dit deel wordt uitgelegd hoe packages geïnstalleerd, geladen en beheerd worden. Er wordt aandacht besteed aan CRAN, `install.packages()`, en `library()`.

2.  **Working directory**\
    Hier wordt besproken hoe men de working directory instelt, controleert en aanpast, en waarom dit belangrijk is voor het beheren van bestanden en datasets.

3.  **R basics**\
    In deel 3 geven we een overzicht van basiselementen m.b.t. programmeren in R, waaronder soorten variabelen, datatypes, operatoren, en functies.

4.  **Werken met data in R**\
    Hier behandelen we het inladen en manipuleren van datasets. Er wordt gewerkt met `readr, dplyr` en `tidyr` uit het tidyverse-ecosysteem.

5.  **Graphics en visualisaties**\
    Introductie tot datavisualisatie in R, met focus op `ggplot2`. Zowel eenvoudige plots als meerlagige grafieken komen aan bod.

6.  **Geavanceerde functies**\
    In deze 'gevorderde sectie' wordt ingegaan op het schrijven van functies en het gebruik van loops in R.

------------------------------------------------------------------------

## 1. Gebruik van packages

R biedt via zijn package-ecosysteem toegang tot een enorm scala aan aanvullende functionaliteiten. Packages kunnen afkomstig zijn van verschillende bronnen, waaronder:

-   **CRAN**: het centrale distributieplatform voor R-packages.
-   **Bioconductor**: gespecialiseerd in bioinformatica en statistische genomica.
-   **GitHub**: vaak gebruikt voor experimentele of in ontwikkeling zijnde packages.

### 1.1 Installatie van packages via CRAN

De meeste packages zijn beschikbaar via het CRAN-netwerk. Ze worden als volgt geïnstalleerd:

```{r include=FALSE}
#install.packages("ggplot2")
```

Een package moet na installatie telkens opnieuw worden geladen in een nieuwe R-sessie:

```{r include=FALSE}
library(ggplot2)
```

Meerdere packages tegelijk installeren kan als volgt:

```{r include=FALSE}
#install.packages(c("dplyr", "tidyr", "readr"))
#lapply(c("dplyr", "tidyr", "readr"), library, character.only = TRUE)
```

### 1.2 Installatie van packages via Bioconductor (optioneel, ter info, niet uitvoeren)

Bioconductor is een apart platform voor packages gericht op computationele biologie en statistische genomica. Voor toegang tot Bioconductor gebruikt men het `BiocManager` package:

```{r include=FALSE}
#if (!require("BiocManager")) {
  #install.packages("BiocManager")
#}

#BiocManager::install("GenomicFeatures")
#library(GenomicFeatures)
```

Bioconductor-packages worden ook onderhouden via een centrale infrastructuur en zijn onderhevig aan kwaliteitscontrole.

### 1.3 Installatie van packages via GitHub (optioneel, ter info, niet uitvoeren)

Sommige packages zijn (nog) niet beschikbaar op CRAN of Bioconductor, maar worden gedeeld via GitHub. Hiervoor gebruikt men het `devtools` of `remotes` package:

```{r echo=TRUE}
# Eerst devtools installeren indien nodig
#if (!require("remotes")) {
  #install.packages("remotes")
#}

# Installatie vanaf GitHub
#remotes::install_github("hadley/emo")
#library(emo)
```

Let op: GitHub-packages zijn niet noodzakelijk stabiel en zijn vaak in ontwikkeling.

### 1.4 Controle en beheer

Om te controleren of een package reeds geïnstalleerd is:

```{r echo=TRUE}
# if (!requireNamespace("dplyr", quietly = TRUE)) {
#   install.packages("dplyr")
#   message("Package 'dplyr' werd geïnstalleerd.")
# } else {
#   message("Package 'dplyr' is reeds geïnstalleerd.")
# }
# 
# library(dplyr)

```

Om een overzicht van alle geïnstalleerde packages te verkrijgen:

```{r echo=TRUE, paged.print=TRUE}
# installed.packages()[, "Package"]
```

### 1.5 Belang van reproduceerbaarheid

Bij het delen van scripts of rapporten is het handig om expliciet te vermelden welke packages gebruikt worden, inclusief versienummers. Dit kan via:

```{r echo=TRUE}
sessionInfo()
```

of

```{r echo=TRUE}
devtools::session_info()
```

------------------------------------------------------------------------

## 2. Working directory

Een correcte configuratie van de **working directory** is essentieel voor het betrouwbaar en reproduceerbaar uitvoeren van scripts in R. De working directory bepaalt namelijk het pad van waaruit bestanden ingelezen en weggeschreven worden.

### 2.1 Wat is de working directory?

De working directory is het bestandspad waar R zoekt naar bestanden of waar het bestanden opslaat als er geen expliciet pad wordt opgegeven:

```{r echo=TRUE}
# Toon huidige working directory
getwd()
```

Je kunt de working directory tijdelijk instellen met:

```{r echo=TRUE}
# Stel de working directory in
setwd("C:/Users/rkhalfa/OneDrive - UGent/Robin Khalfa/12. OPLEIDINGEN/SNA IN R/SNA met R")
getwd()
```

> Het gebruik van `setwd()` wordt afgeraden in gedeelde scripts, omdat dit afhankelijk is van het lokale bestandssysteem van de gebruiker.

### 2.2 Het probleem met `setwd()` in gedeelde projecten

Scripts die `setwd()` gebruiken met absolute paden zijn **niet reproduceerbaar** op andere systemen. Zo zal een pad als:

```{r echo=TRUE}
setwd("C:/Users/rkhalfa/OneDrive - UGent/Robin Khalfa/12. OPLEIDINGEN/SNA IN R")
```

niet werken op een andere computer of besturingssysteem. Dit leidt tot fouten bij het inladen of wegschrijven van bestanden.

### 2.3 RStudio-projecten (.Rproj) als oplossing

Een **RStudio-project** (`.Rproj`) creëert een afzonderlijke werkomgeving waarbij de projectmap automatisch ingesteld wordt als working directory. Dit biedt meerdere voordelen:

-   Reproduceerbaarheid: scripts verwijzen relatief naar bestanden binnen de projectstructuur.
-   Bestandsorganisatie: analyses, data en scripts worden binnen één consistente structuur bewaard.
-   Integratie: RStudio onthoudt de laatste werksessie, open bestanden, enz.

#### Aanmaken van een project

In RStudio:

> File → New Project → New Directory → R Project\
> Kies een map en een naam, bijvoorbeeld: `MyFirstSNA`

Dit maakt automatisch een `.Rproj`-bestand aan. Bij het openen van dit bestand wordt de working directory automatisch op de projectmap ingesteld:

```{r echo=TRUE}
getwd()
# [1] ".../MyFirstSNA"
```

Vanaf dan kun je werken met **relatieve paden**, zoals:

```{r echo=TRUE}
data <- read.csv("Data/1100_affective_w1.csv")
print(data)
```

in plaats van absolute paden.

### 2.4 Best practices voor deelbare projecten

Voor projecten die gedeeld worden via e-mail, cloud (bv. OneDrive), of 
versiebeheer (zoals GitHub), is het aanbevolen om de volgende structuur 
aan te houden:

![](images/Structure.png)

Enkele aanbevelingen:

-   Gebruik **relatieve paden** binnen scripts.
-   Houd ruwe data in een aparte `data/` map.
-   Voeg een `README.md` toe met uitleg over de structuur en inhoud.
-   Zet geen `setwd()`-commando’s in gedeelde scripts.
-   Gebruik `.Rproj` als ingangspunt voor de werkomgeving.

------------------------------------------------------------------------

## 3. R Basics

In wat volgt gaat we in op enkele fundamentele eigenschappen van R als programmeertaal en rekenomgeving. R is een expressieve en flexibele taal, met een eigen syntax en gedragingen.

### 3.1 Basiskenmerken van de R-console

-   **R is 'case-sensitive'**: `Data`, `data`, en `DATA` zijn verschillende objecten.
-   **`#` duidt op een commentaarregel**: alles na een `#` wordt genegeerd door de interpreter.
-   Een **`+`-symbool in de console** betekent dat R wacht op verdere input, omdat de opdracht nog niet syntactisch volledig is
-   **Spaties zijn belangrijk** in bepaalde gevallen (zoals in bestandsnamen), maar de meeste spaties binnen expressies zijn toegestaan.
-   Indien de console vastloopt (bijv. bij een onafgewerkte haak), druk op `Esc` om het proces af te breken en opnieuw te beginnen (of druk op `stop` in de console).

------------------------------------------------------------------------

### 3.2 Simpele wiskundige bewerkingen

R kan rechtstreeks gebruikt worden als een 'rekenmachine':

```{r echo=TRUE}
3 + 5       # Optelling
10 - 4      # Aftrekking
6 * 7       # Vermenigvuldiging
8 / 2       # Deling
2^3         # Exponentiële macht
sqrt(25)    # Vierkantswortel
log(100)    # Natuurlijke logaritme
log10(100)  # Logaritme in basis 10
```

------------------------------------------------------------------------

### 3.3 Objecten en naamgeving in R

In R worden gegevens opgeslagen in **objecten**. Objecten kunnen variabelen, vectoren, tabellen, functies, enz. bevatten. Objecten worden toegekend met het `<-` (aanbevolen) of `=` operator:

```{r echo=TRUE}
getal <- 42
woord <- "Statistiek" # (kan ook met '')
getal
woord
```

R is objectgeoriënteerd: alles wat je aanmaakt of gebruikt is een object.

#### Naamgeving

-   **Snake case** wordt vaak gebruikt: `gemiddelde_waarde`
-   Andere stijlen zoals `camelCase` of `dot.notatie` zijn ook mogelijk, maar wees consistent.
-   Namen mogen geen spaties bevatten, starten met een letter, en mogen geen gereserveerde woorden omvatten.

------------------------------------------------------------------------

### 3.4 Functies in R

R gebruikt een grote hoeveelheid ingebouwde functies. De syntaxis is: `functie(argumenten)`. Bijvoorbeeld:

```{r echo=TRUE}
c(1, 2, 3, 5)  # Combineert getallen tot een vector
mean(c(1, 2, 3, 5))  # Berekening van het gemiddelde
```

#### Hulpfunctie

Voor documentatie over een functie:

```{r echo=TRUE}
?mean
help(mean)
```

Om te zoeken binnen alle helpbestanden:

```{r echo=TRUE}
??"linear model"
```

------------------------------------------------------------------------

### 3.5 Vectoren in R

**Vectoren** zijn één van de meest belangrijke datastructuren in R. Een vector is een geordende reeks elementen van hetzelfde datatype.

#### Aanmaak van vectoren

```{r echo=TRUE}
x <- c(10, 20, 30)           # Numerieke vector
y <- c("A", "B", "C")        # Karaktervector
z <- c(TRUE, FALSE, TRUE)    # Logische vector
x
y
z
```

#### Vectoroperaties

```{r echo=TRUE}
x + 1        # Elk element verhoogd met 1
x * 2        # Vermenigvuldiging per element
length(x)    # Aantal elementen
```

> Let op: vectoren zijn homogeen (alle elementen moeten van hetzelfde type zijn). 
Gebruik `list()` voor heterogene verzamelingen.

#### Extractie van elementen

Elementen kunnen worden geselecteerd op basis van hun **positie** (indexering) 
of via **logische expressies**:

```{r echo=TRUE}
x[2]         # Tweede element (20)
x[c(1,3)]    # Eerste en derde element (10, 30)

x[x > 15]    # Elementen groter dan 15
```

-   R gebruikt **1-gebaseerde indexering** (dus de eerste positie is 1, niet 0 zoals in Python).
-   Logische expressies evalueren elk element individueel tot `TRUE` of `FALSE`.

#### Combinatie van voorwaarden

Meerdere voorwaarden kunnen gecombineerd worden met **logische operatoren**:

```{r echo=TRUE}
x[x > 10 & x < 30]   # Tussen 10 en 30 (exclusief)
x[x == 10 | x == 30] # Gelijk aan 10 of 30
x[!is.na(x)]         # Alle niet-NA elementen
```

-   `&`: logische EN\
-   `|`: logische OF\
-   `!`: logische NIET

#### Ordenen van vectoren

Vectoren kunnen gesorteerd worden:

```{r echo=TRUE}
sort(x)              # Oplopende volgorde
sort(x, decreasing = TRUE)  # Aflopende volgorde
```

Via **positionele ordening** kun je andere vectoren herordenen op basis van 
een sorteersleutel:

```{r echo=TRUE}
namen <- c("Alice", "Bob", "Chris")
scores <- c(88, 95, 82)

order_index <- order(scores)   # Posities voor oplopende ordening
namen[order_index]             # Namen gesorteerd volgens score
```

Dit is handig om de **relatie tussen kolommen te behouden** in bijvoorbeeld 
dataframes of gekoppelde vectoren.

#### Vectorisatie in R

De meeste functies in R zijn **vectorized**: ze worden impliciet toegepast 
op elk element van een vector, zonder dat hiervoor expliciete loops nodig zijn.

```{r echo=TRUE}
x <- c(1, 2, 3)
y <- c(10, 20, 30)
x + y       # [11 22 33]
```

Indien vectoren ongelijke lengte hebben, past R automatisch '**recycling'** toe:

```{r echo=TRUE}
x <- c(1, 2, 3, 4)
y <- c(10, 20)
x + y       # [11 22 13 24]  → y wordt gerecycled
```

> Als de lengte van de langere vector **geen veelvoud** is van de kortere, 
geeft R een waarschuwing.

#### Omgaan met ontbrekende waarden

Ontbrekende waarden worden aangeduid met `NA`:

```{r echo=TRUE}
waarden <- c(1, 2, NA, 4)
mean(waarden)             # Resultaat: NA
mean(waarden, na.rm = TRUE)  # Resultaat: 2.33
```

Veel functies bieden het argument `na.rm = TRUE` om `NA`-waarden te negeren 
bij berekeningen.

#### Functionele flexibiliteit

R-functies zijn doorgaans **configureerbaar via argumenten**, wat toelaat om 
gedrag aan te passen aan specifieke behoeften:

```{r echo=TRUE}
round(3.14159, digits = 2)  # Afronden tot 2 decimalen
rep(1:3, times = 2)         # Herhaal vector
seq(from = 1, to = 5, by = 0.5)  # Genereer sequentie
```

------------------------------------------------------------------------

### 3.6 Opslaan en laden van objecten

Om objecten op te slaan:

```{r echo=TRUE}
save(x, y, file = "objecten.RData")  # Specifieke objecten
save.image(file = "workspace.RData") # Volledige werksessie
```

Om objecten terug in te laden:

```{r echo=TRUE}
load("objecten.RData")
```

Bestanden worden doorgaans opgeslagen in `.RData` of `.rda`-formaat. 
Zorg dat je working directory correct ingesteld is (zie vorige sectie).

------------------------------------------------------------------------

## 4. Werken met data in R

Werken met data is de belangrijkste activiteit binnen data-analyse in R. 
Dit deel biedt een overzicht van de belangrijkste concepten en toepassingen.

### 4.1 Datatypes in R

R ondersteunt zes basis datatypes:

```{r echo=TRUE}
class(3.14)        # numeric
class(4L)          # integer
class("tekst")     # character
class(TRUE)        # logical
class(2+3i)        # complex
class(as.raw(2))   # raw
```

-   **Numeric**: decimale getallen (vb. 3.14)
-   **Integer**: gehele getallen (vb. 4L)
-   **Character**: tekstuele waarden
-   **Logical**: TRUE of FALSE
-   **Complex**: getallen met een imaginaire component
-   **Raw**: ruwe bytes

### 4.2 Datastructuren in R

De meest gebruikte datastructuren in R zijn:

| Structuur | Beschrijving |
|---------------------------|---------------------------------------------|
| **Vector** | Reeks van elementen van hetzelfde datatype |
| **Matrix** | 2D-array met homogeen datatype |
| **Array** | Multidimensionale uitbreiding van matrices |
| **List** | Heterogene container voor objecten |
| **Data frame** | Tabelvormige structuur met kolommen van verschillende types |

```{r echo=TRUE}
v <- c(1, 2, 3)                           # vector
m <- matrix(1:6, nrow = 2)               # matrix
a <- array(1:8, dim = c(2,2,2))          # array
l <- list(getal = 1, tekst = "abc")     # list
df <- data.frame(id = 1:3, naam = c("A", "B", "C"))  # data frame

#Print out
v
m
a
l
df

#saveRDS(v, file = 'Data/v_object.rds')
```

### 4.3 Importeren van data

R ondersteunt verschillende methoden voor het importeren van data. 
Veelgebruikte functies zijn:

```{r echo=TRUE}
read.csv("Data/1100_affective_w1.csv", header = TRUE, sep = ",")
read.table("Data/attributes_clubs.txt", header = TRUE, sep = "\t")
readRDS("Data/v_object.rds")
load("Data/talk_nets_undirected.RData")
```

| Bestandstype         | Functie        | Belangrijke argumenten              |
|-------------------|-------------------|----------------------------------|
| CSV                  | `read.csv()`   | `sep`, `header`, `stringsAsFactors` |
| TXT                  | `read.table()` | `sep`, `na.strings`, `colClasses`   |
| Excel (via `readxl`) | `read_excel()` | `sheet`, `col_types`, `range`       |
| RDS                  | `readRDS()`    | \-                                  |
| RData                | `load()`       | \-                                  |

Gebruik `readr::read_csv()` voor snellere import via tidyverse.

### 4.4 Data Wrangling

**Data wrangling** verwijst naar het proces van het transformeren, structureren 
en manipuleren van ruwe data tot een geschikt formaat voor analyse.

------------------------------------------------------------------------

```{r echo=TRUE}
#install.packages('tidyverse')
#install.packages('dplyr')
library(tidyverse)
library(dplyr)
```

#### 4.4.1 Selectie van gegevens: indexering


**1. Positionele indexering (via rijen en kolommen):**

```{r echo=TRUE}
df[1, 2]        # Rij 1, kolom 2
df[ , "naam"]   # Kolom 'naam'
df[1:2, ]       # Eerste twee rijen
```

**2. Logische indexering (gebaseerd op voorwaarden):**

```{r echo=TRUE}
df[df$id > 1, ]           # Rijen met id > 1
```

Alternatief:

```{r echo=TRUE}
df %>% filter(id > 1)
```

#### 4.4.2 Manipuleren van rijen en kolommen


**Toevoegen of verwijderen van kolommen:**

```{r echo=TRUE}
df$score <- c(70, 65, 35)  # Nieuwe kolom
df
#df$score <- NULL                    # Verwijderen van kolom
```

Met `dplyr`:

```{r echo=TRUE}
df <- df %>%
  mutate(new_var = c(70, 65, 35)) 
df
```

```{r echo=TRUE}
df <- df %>%
  mutate(new_var = c(70, 65, 35)) %>% # Opnieuw verwijderen nieuwe variabele
  select(-new_var)
df
```

**Toevoegen of verwijderen van rijen:**

```{r echo=TRUE}
nieuwe_rij <- data.frame(id = 4, naam = "Robin", score = 89)
df <- rbind(df, nieuwe_rij)        # Rij toevoegen
df
#df <- df[-1, ]                     # Verwijder eerste rij
```

Tidyverse:

```{r echo=TRUE}
df <- bind_rows(df, nieuwe_rij) %>% slice(-5)
df
```

#### 4.4.3 Ordenen van data


**Sorteren van rijen:**

```{r echo=TRUE}
df[order(df$score), ] #Oplopend
df[order(-df$score), ]  # Aflopend
```

Met `dplyr::arrange()`:

```{r echo=TRUE}
df %>% arrange(desc(score))
```

**Herordenen van kolommen:**

```{r echo=TRUE}
df <- df[ , c("id", "score", "naam")]
df
```

Of met select:

```{r echo=TRUE}
df %>% select(id, naam, score)
```

#### 4.4.4 Samenvoegen van datasets

```{r echo=TRUE}
df2 <- data.frame(
  id = 5:20,  # 13 waarden
  naam = c("Eva", "Tom", "Lena", "Max", "Sara", "Joris", "Anna", "Paul", 
           "Lily", "Hans", "Marie", "Niels", "Laura", "Wim", "Jonas", "Rein"),
  score = sample(50:100, 16, replace = TRUE)
)
df2
```

**Verticaal (rijen toevoegen):**

```{r echo=TRUE}
df_combined <- rbind(df, df2)
df_combined
```

**Horizontaal (kolommen toevoegen):**

```{r echo=TRUE}
geslaagd <- df_combined$score >= 50
df_combined <- cbind(df_combined, geslaagd)
df_combined
```

Kan natuurlijk veel gemakkelijker:

```{r echo=TRUE}
df_combined <- df_combined %>% select(-geslaagd)
df_combined$geslaagd <- df_combined$score >= 50
df_combined
```

**Join-operaties (zoals in SQL):**

```{r echo=TRUE}
df1 <- data.frame(
  id = 1:5,
  naam = c("Eva", "Tom", "Lena", "Max", "Sara")
)

df3 <- data.frame(
  id = c(3, 4, 5, 6, 7),
  score = c(78, 88, 91, 65, 72)
)

# Inner join: enkel rijen met overeenkomende 'id'
df_merged_inner <- merge(df1, df3, by = "id", all = FALSE)

# Left join: behoud alle rijen uit df1
df_merged_left <- merge(df1, df3, by = "id", all.x = TRUE)

# Full join: behoud alle rijen uit beide
df_merged_full <- merge(df1, df3, by = "id", all = TRUE)

# Print out
df_merged_inner
df_merged_left
df_merged_full

```

Tidyverse:

```{r echo=TRUE}

# Inner join
df_merged_inner_tidy <- df1 %>%
  inner_join(df3, by = "id")

# Left join
df_merged_left_tidy <- df1 %>%
  left_join(df3, by = "id")

# Full join
df_merged_full_tidy <- df1 %>%
  full_join(df3, by = "id")

# Anti join: toon rijen in df1 die géén match hebben in df2
df_anti_tidy <- df1 %>%
  anti_join(df3, by = "id")

# Print out
df_merged_inner_tidy
df_merged_left_tidy 
df_merged_full_tidy
df_anti_tidy 

```

#### 4.4.5 Hervormen van data

```{r echo=TRUE}
df4 <- data.frame(
  id = 1:3,
  naam = c("Eva", "Tom", "Lena"),
  jaar_2022 = c(75, 88, 93),
  jaar_2023 = c(82, 90, 95)
)

df4
```

**Van breed naar lang formaat (pivoting):**

```{r echo=TRUE}
df_long <- df4 %>% pivot_longer(cols = starts_with("jaar"), names_to = "jaar", 
                                values_to = "waarde")

df_long
```

**Van lang naar breed formaat:**

```{r echo=TRUE}
df_breed <- df_long %>% pivot_wider(names_from = "jaar", values_from = "waarde")

df_breed
```

**Splitsen en samenvoegen van kolommen:**

```{r echo=TRUE}
df_datum <- data.frame(
  datum = c("2023-05-12", "2024-03-08", "2024-11-20"),
  voornaam = c("Eva", "Tom", "Lena"),
  achternaam = c("Peeters", "Janssens", "De Smet")
)

df_datum
```

```{r echo=TRUE}
df_gesplitst <- df_datum %>%
  separate(col = datum, into = c("jaar", "maand", "dag"), sep = "-")

df_samengevoegd <- df_gesplitst %>%
  unite("volledige_naam", voornaam, achternaam, sep = " ")

df_gesplitst
df_samengevoegd
```

#### 4.4.6 Samenvatten en groeperen


Gebruik van `dplyr` voor samenvattende statistieken:

```{r echo=TRUE}
df_scores <- data.frame(
  id = 1:6,
  categorie = c("A", "A", "B", "B", "C", "C"),
  score = c(75, 82, 91, 85, 44, 63)
)

df_scores
```

```{r echo=TRUE}
df_scores %>%
  group_by(categorie) %>%
  summarise(
    gemiddelde = mean(score, na.rm = TRUE),
    aantal = n()
  )

```

Meerdere samenvattingen combineren:

```{r echo=TRUE}
df_scores %>%
  group_by(categorie) %>%
  summarise(across(
    where(is.numeric),
    list(mean = mean, sd = sd),
    na.rm = TRUE
  ))

```

------------------------------------------------------------------------

## 5. Graphics en visualisaties

R is heel krachtig wat betreft het visualiseren van data. 
Grafieken bieden een intuïtieve manier om patronen, trends en anomalieën te 
identificeren in datasets. In R bestaan er drie hoofdbenaderingen voor het 
aanmaken van grafieken:

-   **Base R graphics**: het originele, flexibele maar minder gestructureerde systeem
-   **Lattice graphics**: gericht op multi-panel visualisaties (behandelen we niet hier)
-   **ggplot2**: gebaseerd op het principe 'Grammar of Graphics'

Elke methode heeft haar eigen filosofie, sterktes en typische toepassingsgebieden.

### 5.1 Base R Graphics


Het base graphics-systeem in R biedt eenvoudige maar flexibele grafische functies. 
Het systeem is opgebouwd rond twee groepen functies:

-   **High-level functies**: creëren een nieuwe grafiek (zoals `plot()`, `hist()`, `boxplot()`).
-   **Low-level functies**: voegen elementen toe aan een bestaande grafiek (zoals `lines()`, `points()`, `text()`, `legend()`).

Base R is veelzijdig, maar vereist manuele controle en is minder consistent in 
syntax tussen verschillende plottypes.

-   Basis plot (bv. scatterplot):

```{r echo=TRUE}
# Basis scatterplot
x <- 1:10
y <- x^2

plot(x, y, main = "Scatterplot", xlab = "X-waarde", ylab = "Y-waarde", pch = 19, 
     col = "red")

```

-   Aanpassen van de marges:

```{r echo=TRUE}
par(mar = c(5, 6, 4, 2))# Instellingen marges: c(boven, links, onder, rechts)
plot(x, y, main = "Scatterplot", xlab = "X-waarde", ylab = "Y-waarde", pch = 19, 
     col='red')
```

-   Kleuren op basis van numerieke variabele:

```{r echo=TRUE}
kleuren <- ifelse(x < 5, "blue", "red")
par(mar = c(5, 6, 4, 2))
plot(x, y, main = "Scatterplot", xlab = "X-waarde", ylab = "Y-waarde", pch = 19, 
     col = kleuren)
```

-   Lijnen en achtergrond

```{r echo=TRUE}
par(mar = c(5, 6, 4, 2))
plot(x, y, main = "Scatterplot met regressielijn", xlab = "X-waarde", 
     ylab = "Y-waarde", pch = 19, col = kleuren)
abline(lm(y ~ x), col = "red")  # Regressielijn in rood
```

-   Instellen van achtergrond en askleuren

```{r echo=TRUE}
par(mar = c(5, 6, 4, 2))
par(bg = "lightblue", col.axis = "darkblue", col.lab = "darkred")
plot(x, y, main = "Scatterplot", xlab = "X-waarde", ylab = "Y-waarde", pch = 19, 
     col = 'darkred', col.main = 'darkred')

```

-   Meerdere grafieken tegelijk plotten

```{r echo=TRUE}
par(mfrow = c(1, 2))  # Twee grafieken naast elkaar
par(mar = c(5, 6, 4, 2))
plot(x, y, main = "Grafiek 1: Blauwe punten", xlab = "X-waarde", 
     ylab = "Y-waarde", pch = 19, col = "blue")
plot(x, y, main = "Grafiek 2: Rode punten", xlab = "X-waarde", 
     ylab = "Y-waarde", pch = 19, col = "darkred")

```

-   Legendes

```{r echo=TRUE}
# Plot met legende
plot(x, y, main = "Plot met legende", xlab = "X-waarde", ylab = "Y-waarde", 
     pch = 19, col = "orange")
legend("topleft", legend = "Data", col = "orange", pch = 19)

```

-   Exporteren van base R visualisatie (voorbeeld)

```{r echo=TRUE}
# Exporteren van grafiek naar PNG met kleuren
png("scatterplot.png", width = 800, height = 600, res = 150)
plot(x, y, main = "Scatter", xlab = "X-waarde", ylab = "Y-waarde", 
     pch = 19, col = "darkgreen")
dev.off()

```

-   Enkele veel gebruikte plots en diens functie in R

| Plot type | Functie | Beschrijving | Voorbeeld code |
|------------------|------------------|-------------------|------------------|
| **Scatter plot** | `plot()` | Basisfunctie voor het tekenen van een scatter plot tussen twee variabelen. | `plot(x, y)` |
| **Lijn plot** | `plot()` | Gebruikt voor het tekenen van een lijnplot, vooral als de argumenten `type = "l"` zijn. | `plot(x, y, type = "l")` |
| **Histogram** | `hist()` | Teken een histogram voor een enkele variabele. | `hist(data)` |
| **Boxplot** | `boxplot()` | Teken een boxplot om de spreiding van de data en de aanwezigheid van outliers te visualiseren. | `boxplot(data)` |
| **Barplot** | `barplot()` | Teken een barplot voor het visualiseren van de frequenties van categorieën. | `barplot(table(data))` |
| **Pie chart** | `pie()` | Teken een taartdiagram om proporties van een totaal te visualiseren. | `pie(c(10, 20, 30, 40))` |
| **Density plot** | `plot(density())` | Plot de dichtheidsfunctie van een continue variabele. | `plot(density(data))` |
| **Lijn plot met meerdere lijnen** | `matplot()` | Teken meerdere lijnen in één grafiek. | `matplot(x, y, type = "l")` |
| **Stem-and-leaf plot** | `stem()` | Visualiseer de verdeling van een numerieke variabele als een stem-and-leaf plot. | `stem(data)` |
| **Scatterplot matrix** | `pairs()` | Maak een matrix van scatter plots om de relaties tussen meerdere variabelen te bekijken. | `pairs(~ var1 + var2 + var3, data = df)` |
| **Heatmap** | `heatmap()` | Maak een heatmap van een matrix of dataset om patronen te visualiseren. | `heatmap(matrix_data)` |
| **Correlogram** | `cor()` + `image()` | Visualiseer de correlatie van variabelen in een matrixvorm. | `image(cor(data))` |
| **QQ-Plot** | `qqnorm()` / `qqline()` | Visualiseer de normaalverdeling van data met een QQ-plot. | `qqnorm(data); qqline(data)` |

```{r echo=TRUE}
# Line Plot
plot(x, y, type = "l", col = "red", main = "Line plot", xlab = "X-axis", 
     ylab = "Y-axis")

# Histogram
hist(df_combined$score, col = "lightblue", main = "Histogram", xlab = "Value", 
     breaks = 10)

# Boxplot
boxplot(df_combined$score, main = "Boxplot", col = "lightgreen")

# Barplot
barplot(table(df_combined$score), col = "purple", main = "Barplot", 
        xlab = "Categories", ylab = "Frequency")

```

### 5.2. ggplot


`ggplot` is een krachtig en consistent systeem voor datavisualisatie in R, gebaseerd op het principe van Grammar of Graphics. Het werkt modulair: grafieken worden opgebouwd in lagen.

```{r echo=TRUE}
library(ggplot2)
library(dplyr)
```

#### 5.2.1. Basisstructuur van een ggplot


Elke plot in `ggplot2` begint met de functie `ggplot()`, die de dataset en esthetiek (aesthetic mappings) definieert. Vervolgens voeg je een geometrie toe (zoals een punt, lijn, of boxplot) via `geom_*()` functies.

De algemene structuur is:

``` r
ggplot(data = dataset, aes(x = x_variable, y = y_variable, color = group_variable)) +
  geom_*()
```

Belangrijke componenten:

-   `data`: De dataset die je gebruikt.

-   `aes()`: De esthetiek die bepaalt hoe de variabelen worden weergegeven (bijv. x-as, y-as, kleur).

    -   `x`: Variabele voor de x-as.

    -   `y`: Variabele voor de y-as.

    -   `color`: Kleur van de punten, lijnen, etc. (vaak gebruikt voor categorische variabelen).

    -   `size`: Grootte van de punten of lijnen.

    -   `shape`: Vorm van de punten.

    -   `fill`: Vulkleur voor objecten zoals bars of gebieden.

#### 5.2.2. `geom_*` functies


De geometrieën bepalen wat er wordt 'getekend' op een plot. 
Elk type plot in ggplot2 wordt gemaakt door een geometrie toe te voegen via een geom\_\*() functie.

Belangrijke geometrieën zijn:

-   `geom_point()`: Voor een scatterplot, waarbij punten worden getekend.

-   `geom_line()`: Voor een lijngrafiek.

-   `geom_histogram()`: Voor een histogram.

-   `geom_boxplot()`: Voor een boxplot.

-   `geom_bar()`: Voor een staafdiagram (meestal voor categorische variabelen).

-   `geom_smooth()`: Voor het toevoegen van een trendlijn

**Voorbeeld**

```{r echo=TRUE}
# We gebruiken de standaard Iris dataset die beschikbaar is in base R
head(iris, 6)
```

```{r echo=TRUE}
# Basis scatterplot van naam tegen score
ggplot(data = iris, aes(x = Sepal.Length, y = Sepal.Width, fill = Species)) +
  geom_point(size = 4, shape = 21, color = "black") 

```

```{r echo=TRUE}
# Basis scatterplot van naam tegen score
ggplot(data = iris, aes(x = Sepal.Length, color = Species, fill = Species)) +
  geom_histogram(size = 0.5, color = "black", bins = 30) 

```

#### 5.2.3. Labels en titels


Met de functie labs() kan je belangrijke tekstuele elementen aan je grafiek 
toevoegen, zoals de plot titel, de as-labels, een ondertitel, en de tekst voor 
de legenda.

Belangrijke argumenten van `labs()`:

-   `title`: De titel van de plot.

-   `subtitle`: De ondertitel van de plot.

-   `x`: Het label voor de x-as.

-   `y`: Het label voor de y-as.

-   `caption`: Een bijschrift onderaan de plot.

-   `color`: Het label voor de legenda die wordt gebruikt bij een color esthetiek.

```{r echo=TRUE}
# Basis scatterplot van naam tegen score
ggplot(data = iris, aes(x = Sepal.Length, y = Sepal.Width, color = Species)) +
  geom_point() +
  labs(
    title = "Verhouding tussen Sepal Length en Sepal Width",
    subtitle = "Gebaseerd op de iris dataset",
    x = "Sepal Length",
    y = "Sepal Width",
    caption = "Bron: RStudio"
  )

```

#### 5.2.4. Thema's en stijlen

Met `theme()` kun je de algehele uitstraling van je grafiek aanpassen. 
Dit stelt je in staat om de achtergrond, as-titels, as-etiketten, en andere 
visuele elementen aan te passen.

Belangrijke argumenten:

-   `theme_minimal()`, `theme_classic()`, `theme_dark()`: Voorgeconfigureerde thema's die een plot een andere visuele stijl geven.

-   `axis.text`: Aangepaste tekst voor de assen.

-   `axis.title`: Aangepaste titel voor de assen.

-   `plot.title`: Aangepaste titel voor plot.

-   `panel.background`: Achtergrondkleur van plot.

```{r echo=TRUE}
# Basis scatterplot van naam tegen score
ggplot(data = iris, aes(x = Sepal.Length, y = Sepal.Width, fill = Species)) +
  geom_point(size = 4, shape = 21, color = 'black') +
  labs(
    title = "Verhouding tussen sepal length en sepal width",
    subtitle = "Gebaseerd op de iris dataset",
    x = "Sepal Length",
    y = "Sepal Width",
    caption = "Bron: RStudio"
  ) +
  theme_minimal() +
  theme(
    plot.title = element_text(size = 16, hjust = 0.5),
    plot.subtitle = element_text(size = 10, hjust = 0.5),
    axis.title.x = element_text(size = 10, color = "black"),
    axis.title.y = element_text(size = 10, color = "black"),
    axis.text.x = element_text(size = 10, angle = 45, hjust = 1),
    axis.text.y = element_text(size = 10),
    plot.caption = element_text(hjust = 1.2, size = 8, face = "italic"), 
    plot.margin = margin(t = 10, r = 10, b = 20, l = 20)
  )

```

#### 5.2.5. Facetting

Facetting helpt je om meerdere subplots te maken, bijvoorbeeld door je data te 
splitsen op basis van een categorische variabele.

Belangrijke functies:

-   `facet_wrap()`: Maakt facetten op basis van één variabele.

-   `facet_grid()`: Maakt facetten op basis van twee variabelen (rijen en kolommen).

```{r echo=TRUE}
# Basis scatterplot met facetten per soort
ggplot(data = iris, aes(x = Sepal.Length, y = Sepal.Width)) +
  geom_point(aes(color = Species)) +
  facet_wrap(~ Species, ncol = 3) +  # Horizontale facettering op basis van Species
  labs(
    title = "Verhouding tussen sepal length en sepal width",
    subtitle = "Gebaseerd op de iris dataset",
    x = "Sepal Length",
    y = "Sepal Width",
    caption = "Bron: RStudio"
  ) +
  theme_minimal()  +
  theme(
    plot.title = element_text(size = 16, hjust = 0.5),
    plot.subtitle = element_text(size = 10, hjust = 0.5),
    axis.title.x = element_text(size = 10, color = "black"),
    axis.title.y = element_text(size = 10, color = "black"),
    axis.text.x = element_text(size = 10, angle = 45, hjust = 1),
    axis.text.y = element_text(size = 10),
    plot.caption = element_text(hjust = 1.2, size = 8, face = "italic"), 
    plot.margin = margin(t = 10, r = 10, b = 20, l = 20), 
    legend.position = "none"
  )

```

```{r echo=TRUE}
# Basis scatterplot met facetten per soort
ggplot(data = iris, aes(x = Sepal.Length, y = Sepal.Width)) +
  geom_point(aes(color = Species)) +
  facet_grid(. ~ Species) +  # Horizontale facettering op basis van Species
  labs(
    title = "Verhouding tussen sepal length en sepal width",
    subtitle = "Gebaseerd op de iris dataset",
    x = "Sepal Length",
    y = "Sepal Width",
    caption = "Bron: RStudio"
  ) +
  theme_minimal()  +
  theme(
    plot.title = element_text(size = 16, hjust = 0.5),
    plot.subtitle = element_text(size = 10, hjust = 0.5),
    axis.title.x = element_text(size = 10, color = "black"),
    axis.title.y = element_text(size = 10, color = "black"),
    axis.text.x = element_text(size = 10, angle = 45, hjust = 1),
    axis.text.y = element_text(size = 10),
    plot.caption = element_text(hjust = 1.2, size = 8, face = "italic"), 
    plot.margin = margin(t = 10, r = 10, b = 20, l = 20), 
    legend.position = "none"
  )

```

------------------------------------------------------------------------

## 6. Geavanceerde functies in R (basis)


R laat, net zoals andere programmeertalen, toe om ook zelf meer geavanceerde 
functies en algoritmen te schrijven. Zeker wanneer er gewerkt wordt met grote 
datasets, kan dit zeer handig zijn.

### 6.1. Even achter het gordijn kijken:

Door de naam van een functie te type zonder (), kan je nagaan wat de logica en 
source code is van een functie in R

```{r echo=TRUE}
theme_classic

```

### 6.2. Zelf functies schrijven in R


Een functie is een herbruikbare eenheid van code die een specifieke taak uitvoert. 
Dit bevordert modulariteit, leesbaarheid en reproduceerbaarheid.

Basisstructuur

```{r}
mijn_functie <- function(argument1, argument2) {
  resultaat <- argument1 + argument2
  return(resultaat)
}

# Voorbeeldtoepassing
mijn_functie(3, 5)
```

Voorbeeld met de `iris` dataset

```{r}
# Gemiddelde lengte van kelkblad per soort
mean_sepal <- function(data, soort) {
  subset_data <- subset(data, Species == soort)
  mean(subset_data$Sepal.Length)
}

mean_sepal(iris, "setosa")
```

### 6.3. Loops in R


Loops voeren een blok code herhaaldelijk uit op basis van iteraties of voorwaarden. 
Ze zijn nuttig voor repetitieve taken.

For-loop structuur

```{r}
getallen <- c(1, 2, 3, 4, 5)
for (i in getallen) {
  print(i^2)
}
```

Voorbeeld met `iris` dataset

```{r}
soorten <- unique(iris$Species)

for (soort in soorten) {
  gem <- mean(iris[iris$Species == soort, "Petal.Length"])
  cat("Gemiddelde bloembladlengte voor", soort, ":", gem, "\n")
}
```

### 6.4. Conditionele logica


Conditionele statements sturen de uitvoering van code op basis van 
`TRUE`/`FALSE` condities.

`if`, `else`, en `ifelse`

```{r}
x <- 10
if (x > 5) {
  print("x is groter dan 5")
} else {
  print("x is kleiner of gelijk aan 5")
}

# Vectorized alternatief
vec <- c(3, 7, 9)
ifelse(vec > 5, "Groot", "Klein")
```

Toepassing op `iris` dataset

```{r}
iris$Breedte_categorie <- ifelse(iris$Sepal.Width > 3, "Breed", "Smal")
head(iris[, c("Sepal.Width", "Breedte_categorie")])
```

### 6.5. Combineren van functies, loops en condities

De kracht ligt er vaak in om functies, loops en condities te combineren. 
Dit maakt het mogelijk om dynamische analyses te automatiseren.

Voorbeeld: functie met loop én conditie

```{r}
analyse_soorten <- function(data) {
  soorten <- unique(data$Species)
  resultaten <- list()
  
  for (soort in soorten) {
    subset_data <- data[data$Species == soort, ]
    gem <- mean(subset_data$Petal.Length)
    
    if (gem > 4) {
      resultaten[[soort]] <- paste("Lang bloemblad (", gem, ")")
    } else {
      resultaten[[soort]] <- paste("Kort bloemblad (", gem, ")")
    }
  }
  return(resultaten)
}

analyse_soorten(iris)
```

## 7. Recap

Dit document biedt een overzichtelijke introductie tot het werken met R en RStudio, met als doel de gebruiker vertrouwd te maken met fundamentele concepten, workflows en technieken die essentieel zijn voor data-analyse en statistisch programmeren in R.

We zijn gestart met het gebruik van packages, waarbij het belang van het R-ecosysteem en de rol van CRAN werden toegelicht. Vervolgens kwam het correct instellen van de working directory en het gebruik van R Projects aan bod, als cruciale voorwaarden voor een reproduceerbare en gestructureerde werkomgeving.

Daarna besteedden we aandacht aan de basisprincipes van R, zoals variabelen, datatypes en functies. Op basis van deze fundamenten verkenden we meer toegepaste vaardigheden in het manipuleren van data aan de hand van het tidyverse, met specifieke aandacht voor dplyr, tidyr en readr. Hiermee legden we de basis voor het uitvoeren van gestructureerde en efficiënte datatransformaties.

Het onderdeel over datavisualisatie behandelde het gebruik van ggplot2, met voorbeelden van zowel eenvoudige als meerlagige grafieken. Deze technieken maken het mogelijk om complexe data op een inzichtelijke en visueel aantrekkelijke manier te presenteren.

Tot slot kwamen enkele geavanceerde functionaliteiten aan bod, waaronder het schrijven van eigen functies en het gebruik van control flow-structuren zoals for-loops en if-statements. Deze bouwstenen maken het mogelijk om analyses te automatiseren en schaalbaar op te zetten.

Deze notebook kan dienen als naslagwerk en vertrekpunt voor verder zelfstandig gebruik van R, zowel in een academische als in een professionele omgeving.
